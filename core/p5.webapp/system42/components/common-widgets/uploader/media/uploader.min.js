(function(){p5.uploader=function(n,t,i,r,u,f,e){this._widget=p5.$(n);this._cssClass=t;this._hoverClass=i;this._dropClass=r;this._errorClass=u;this._filter=f==""?[]:f.split("|");this._multiple=e;var o=this;this._widget.el.addEventListener("dragover",function(n){n.preventDefault();o._widget.el.className=o._cssClass+" "+o._hoverClass},!1);this._widget.el.addEventListener("dragleave",function(n){n.preventDefault();o._widget.el.className=o._cssClass},!1);this._widget.el.addEventListener("drop",function(n){if(n.preventDefault(),o.checkFile(n)){if(n.dataTransfer.files.length>0){o._widget.el.className=o._cssClass+" "+o._dropClass;o._files=[];for(var t=0;t<n.dataTransfer.files.length;t++)o._files.push(n.dataTransfer.files[t]);o._count=o._files.length;o.processNext(1)}}else o._widget.el.className=o._cssClass+" "+o._errorClass},!1)};p5.uploader.prototype.checkFile=function(n){var t,i;if(this._filter.length==0)return!0;if(this._multiple===!1&&n.dataTransfer.files.length>1)return!1;for(t=0;t<n.dataTransfer.files.length;t++){var r=n.dataTransfer.files[t].name.split("."),f=r[r.length-1],u=!1;for(i=0;i<this._filter.length;i++)if(this._filter[i]==f){u=!0;break}if(!u)return!1}return!0};p5.uploader.prototype.processNext=function(n){var i=this._files.splice(0,1)[0],r=new FileReader,t=this;r.onload=function(r){t._widget.raise("_onupload",{onsuccess:function(){t._files.length>0?t.processNext(++n):t._widget.el.className=t._cssClass},onbefore:function(u){u.push(["sys42.widgets.uploader.count",t._count]);u.push(["sys42.widgets.uploader.current",n]);u.push(["sys42.widgets.uploader.filename",i.name]);u.push(["sys42.widgets.uploader.content",btoa(r.target.result)])}})};r.readAsBinaryString(i)}})();